(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{118:function(e,t){},127:function(e,t,a){},128:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(17),o=a.n(s),c=(a(74),a(11)),l=(a(75),a(76),a(16)),i=a(9),m=a(10),u=a.n(m),g=a(18),d=a(31),p=a(8),E=a.n(p),h=a(64),v=function(){return r.a.createElement("div",{style:{width:"100%",height:"100%",display:"flex"}},r.a.createElement("img",{src:"https://loading.io/spinners/disqus/index.discuss-messesage-preloader.gif",alt:"spinner",style:{margin:"auto",transform:"translateY(70%)"}}))};a.n(h).a.config();var f=function(){var e=Object(n.useState)(""),t=Object(d.a)(e,2),a=t[0],s=t[1],o=Object(n.useState)(""),c=Object(d.a)(o,2),l=c[0],i=c[1],m=Object(n.useState)(!1),p=Object(d.a)(m,2),h=p[0],f=p[1],N=function(){var e=Object(g.a)(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),f(!0),E.a.post("http://localhost:3000/api/auth/login",{email:a,password:l}).then(function(){var e=Object(g.a)(u.a.mark(function e(t){var a,n,r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.data.token,e.prev=1,e.next=4,E.a.get("http://localhost:3000/api/chats/currentUser/?token=".concat(a));case 4:n=e.sent,r=n.data.user,localStorage.setItem("CURRENT_USER_ID",r.id),localStorage.setItem("CURRENT_USER_USERNAME",r.username),localStorage.setItem("CURRENT_USER_NAMES","".concat(r.firstName," ").concat(r.lastName)),localStorage.setItem("CURRENT_USER_EMAIL",r.email),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),console.log(e.t0.response.data);case 15:localStorage.setItem("ACCESS_TOKEN",a),window.location.href="/users",f(!1);case 18:case"end":return e.stop()}},e,null,[[1,12]])}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.log(e.response.data.data),f(!1)});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("form",{className:"container",style:{marginTop:30,marginRight:30,marginLeft:30,display:"grid",placeContent:"center",height:"80vh",width:"80vw"},onSubmit:N},r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Email"),r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input",type:"email",vakue:a,onChange:function(e){return s(e.target.value)}}))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Password"),r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input",type:"password",vakue:l,onChange:function(e){return i(e.target.value)}}))),r.a.createElement("button",{type:"submit",className:"button"},"Login"),h?r.a.createElement(v,null):null)},N=a(25),S=a(26),b=a(29),w=a(27),R=a(15),U=a(30),_=a(28),C=a.n(_),k=function(e){var t=e.user,a="/chats/".concat(t.username);return r.a.createElement(l.b,{className:"list-item",to:a},t.username)},I=function(e){function t(e){var a;return Object(N.a)(this,t),(a=Object(b.a)(this,Object(w.a)(t).call(this,e))).componentWillMount=function(){var e=Object(R.a)(a).socket,t=localStorage.getItem("ACCESS_TOKEN");e.on("connect",function(){e.emit("user_back",t)});var n=localStorage.getItem("CURRENT_USER_USERNAME");e.on("message_unread",function(e){var t=e.receiver,r=e.unreadCount;console.log("Something is happening..."),n===t&&a.setState({warning:"You have ".concat(r," messages unread")})})},a.componentDidMount=function(){var e=localStorage.getItem("ACCESS_TOKEN");E.a.get("http://localhost:3000/api/chats/users",{headers:{"Content-Type":"application/json",Accept:"application/json",token:e}}).then(function(e){console.log(e.data);var t=e.data.me,n=e.data;if(n.followers.length){var r=[];n.followers.forEach(function(e){e.userId===t.id?r.push(e.follower):r.push(e.followedUser)}),a.setState({users:r})}a.setState({me:t})}).catch(function(e){console.log(e),console.log(e.response.data.message),("jwt expired"===e.response.data.message||e.response.data.error)&&(window.location.href="/")})},a.state={users:[],me:{},warning:""},a.socket=C.a.connect("http://localhost:5000"),a}return Object(U.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.state,t=e.me,a=e.users,s=e.warning;return r.a.createElement(n.Fragment,null,r.a.createElement("div",null,"Welcome back ",t.firstName," ",t.lastName,", select users to chat with."),r.a.createElement("div",{className:"list is-hoverable",style:{marginLeft:"10%",marginRight:"10%"}},a.map(function(e){return r.a.createElement(k,{user:e,key:e.id})})||r.a.createElement("p",null,"No users yet!")),s?r.a.createElement("div",{className:"notification is-warning"},s):null,a.length?null:r.a.createElement("div",{className:"notification is-danger"},r.a.createElement("p",null,"No users to chat with...")))}}]),t}(n.Component),O=a(40),j=function(){return r.a.createElement(n.Fragment,null,r.a.createElement("img",{className:"is-rounded",alt:"chat-avatar",style:{width:30,height:30},src:"http://www.sclance.com/pngs/png-avatar/png_avatar_1048755.png"}))},y=function(e){var t=e.message,a=localStorage.getItem("CURRENT_USER_USERNAME");return t.sender===a?r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"list-item"},r.a.createElement("div",{className:"columns is-mobile"},r.a.createElement("div",{className:"column is-two-thirds"},r.a.createElement("i",null,t.message)),r.a.createElement("div",{className:"column is-one-third"},r.a.createElement("div",{className:"columns is-mobile",style:{padding:20}},r.a.createElement(j,null)," \xa0 \xa0",r.a.createElement("strong",null,a)))))):r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"list-item"},r.a.createElement("div",{className:"columns is-mobile"},r.a.createElement("div",{className:"column is-one-third"},r.a.createElement("div",{className:"columns is-mobile",style:{padding:20}},r.a.createElement(j,null),r.a.createElement("strong",null,t.sender))),r.a.createElement("div",{className:"column is-two-thirds"},r.a.createElement("i",null,t.message)))))},T=function(e){function t(e){var a;return Object(N.a)(this,t),(a=Object(b.a)(this,Object(w.a)(t).call(this,e))).componentWillMount=Object(g.a)(u.a.mark(function e(){var t,n,r,s;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props.match.params,a.setState({loading:!0}),e.prev=2,e.next=5,E.a.get("http://localhost:3000/api/profiles/".concat(t.username));case 5:n=e.sent,console.log(n.data.profile),a.setState({loading:!1,receiverInfo:n.data.profile}),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),console.log(e.t0.response.data.message),a.setState({error:e.t0.response.data.message,loading:!1});case 14:return e.prev=14,r=localStorage.getItem("ACCESS_TOKEN"),e.next=18,E.a.get("http://localhost:3000/api/chats/".concat(t.username),{headers:{token:r}});case 18:s=e.sent,console.log(s.data.messages),s.data.messages.map(function(e){var t={};t.message=e.message,t.sender=e.sender.username,t.receiver=e.receiver.username,t.time=e.createdAt,console.log(t),a.setState({messages:[].concat(Object(O.a)(a.state.messages),[t])})}),e.next=27;break;case 23:e.prev=23,e.t1=e.catch(14),console.log(e.t1.response.data),"jwt expired"===e.t1.response.data.message&&(c.b.error("Token expired, please go login again"),localStorage.clear(),window.location.href="/");case 27:case"end":return e.stop()}},e,null,[[2,10],[14,23]])})),a.componentDidMount=function(){var e=Object(R.a)(a).socket,t=localStorage.getItem("ACCESS_TOKEN");e.on("connect",function(){console.log("We are connected");var a=localStorage.getItem("CURRENT_USER_USERNAME");console.log(a),e.emit("new_user",t)}),e.on("chat",function(e){var t=a.props.match.params,n=localStorage.getItem("CURRENT_USER_USERNAME");console.log("CurrentUser",n),console.log("Sender",e.sender),console.log("Receiver",e.receiver),console.log("Data sender",e.receiver,"User To Chat",t.username),e.receiver!==n&&e.sender!==n||a.setState({messages:[].concat(Object(O.a)(a.state.messages),[e])})}),e.on("no_auth",function(e){var t=e.message;c.b.error(t)})},a.sendMessage=function(e){var t=a.props.match.params,n=localStorage.getItem("CURRENT_USER_USERNAME");e.preventDefault(),a.socket.emit("chat",{message:a.state.message,receiver:t.username,sender:n})},a.state={socketUrl:"http://localhost:5000/chats",message:"",messages:[],error:"",loading:!1,socketId:"",receiverInfo:{}},a.socket=C.a.connect(a.state.socketUrl),a}return Object(U.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this,t=this.props.match.params,a=this.state,s=a.message,o=a.error,i=a.loading,m=a.receiverInfo,u=localStorage.getItem("CURRENT_USER_NAMES"),g=localStorage.getItem("CURRENT_USER_USERNAME"),d={names:u,email:localStorage.getItem("CURRENT_USER_EMAIL"),username:g};return i?r.a.createElement(v,null):(o&&(c.b.error("This user does not exist!"),window.location.href="/users"),r.a.createElement(n.Fragment,null,r.a.createElement("h1",{style:{marginTop:20}},"Your conversation with ",r.a.createElement("strong",null,t.username)),r.a.createElement("br",null),r.a.createElement("div",{className:"card"},r.a.createElement("header",{className:"caed-header"},r.a.createElement("p",{className:"card-header-title"},"Messages")),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"list is-hoverable"},this.state.messages.map(function(e){return r.a.createElement(y,{message:e,key:e.id,receiverInfo:m,senderInfo:d})}))),r.a.createElement("form",{className:"card-footer",onSubmit:this.sendMessage},r.a.createElement("div",{className:"card-footer-item"},r.a.createElement("textarea",{className:"textarea",value:s,onChange:function(t){return e.setState({message:t.target.value})}})),r.a.createElement("div",{className:"card-footer-item"},r.a.createElement("button",{type:"submit",className:"button"},"Send"))),r.a.createElement(l.b,{to:"/logout",className:"button",style:{marginTop:40,marginBottom:20}},"Logout"))))}}]),t}(n.Component),x=function(){return localStorage.clear(),window.location.href="/",r.a.createElement(n.Fragment,null)},A=function(){return r.a.createElement(l.a,null,r.a.createElement(i.c,null,r.a.createElement(i.a,{exact:!0,path:"/users",component:I}),r.a.createElement(i.a,{exact:!0,path:"/chats/:username",component:T}),r.a.createElement(i.a,{exact:!0,path:"/",component:f}),r.a.createElement(i.a,{exact:!0,path:"/logout",component:x})))},M=(a(127),function(){return r.a.createElement("div",{className:"App"},r.a.createElement(A,null),r.a.createElement(c.a,null))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(M,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},69:function(e,t,a){e.exports=a(128)},74:function(e,t,a){}},[[69,1,2]]]);
//# sourceMappingURL=main.0ddf4e3c.chunk.js.map